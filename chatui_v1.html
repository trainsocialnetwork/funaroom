<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>FUN・A・ROOM チャットUI プロトタイプ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic", "Meiryo", sans-serif;
            background: #f1f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 24px;
            color: #1f2933;
        }

        .phone-frame {
            width: 100%;
            max-width: 430px;
            height: 900px;
            background: #101316;
            border-radius: 46px;
            padding: 12px;
            box-shadow: 0 25px 60px rgba(15, 23, 42, 0.35);
            position: relative;
        }

        .screen {
            width: 100%;
            height: 100%;
            background: #ffffff;
            border-radius: 34px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .status-bar {
            height: 54px;
            padding: 0 28px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #ffffff;
            border-bottom: 1px solid rgba(148, 163, 184, 0.3);
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .chat-header {
            padding: 24px 28px 20px;
            background: linear-gradient(145deg, #4A90E2 0%, #5CA0F2 100%);
            color: #fff;
        }

        .assistant-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .assistant-subtitle {
            font-size: 17px;
            opacity: 0.95;
            line-height: 1.6;
        }

        .chat-body {
            flex: 1;
            background: #f7fafc;
            padding: 20px 18px 120px;
            overflow-y: auto;
            position: relative;
        }

        .chat-body::-webkit-scrollbar {
            width: 0;
        }

        .message {
            display: flex;
            margin-bottom: 18px;
            gap: 12px;
            align-items: flex-start;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.assistant {
            flex-direction: row;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4A90E2 0%, #5CA0F2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 20px;
            flex-shrink: 0;
        }

        .bubble {
            max-width: 78%;
            padding: 16px 18px;
            border-radius: 22px;
            font-size: 17px;
            line-height: 1.7;
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
        }

        .assistant .bubble {
            background: #fff;
            border-bottom-left-radius: 8px;
        }

        .user .bubble {
            background: #4A90E2;
            color: #fff;
            border-bottom-right-radius: 8px;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
        }

        .quick-button {
            padding: 16px 20px;
            border-radius: 18px;
            border: none;
            font-size: 18px;
            background: #e2efff;
            color: #2563eb;
            font-weight: 600;
            letter-spacing: 0.04em;
            box-shadow: inset 0 -2px 0 rgba(37, 99, 235, 0.08);
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-button i {
            margin-right: 8px;
        }

        .quick-button:active {
            transform: scale(0.97);
            box-shadow: inset 0 -2px 0 rgba(37, 99, 235, 0.15);
        }

        .card {
            background: #ffffff;
            border-radius: 22px;
            padding: 20px 22px;
            box-shadow: 0 12px 28px rgba(15, 23, 42, 0.12);
            margin-top: 14px;
            font-size: 17px;
            line-height: 1.75;
        }

        .card h3 {
            font-size: 20px;
            margin-bottom: 12px;
        }

        .card p {
            margin-bottom: 10px;
        }

        .card .secondary {
            font-size: 15px;
            color: #64748b;
        }

        .card .action-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 16px;
        }

        .card-button {
            background: #4A90E2;
            color: #fff;
            font-weight: 600;
            border: none;
            border-radius: 14px;
            padding: 12px 18px;
            font-size: 16px;
            box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);
            cursor: pointer;
            transition: all 0.2s;
        }

        .card-button:active {
            transform: scale(0.97);
        }

        .card-button.secondary {
            background: #e2e8f0;
            color: #1f2933;
            box-shadow: none;
        }

        .progress {
            margin-top: 10px;
            font-size: 16px;
            color: #1f2933;
        }

        .progress span {
            font-weight: 700;
        }

        .chat-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            padding: 20px 24px 28px;
            border-top: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 -10px 30px rgba(15, 23, 42, 0.1);
        }

        .footer-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 14px;
        }

        .reply-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .reply-button {
            padding: 16px 12px;
            background: #f1f5f9;
            border-radius: 16px;
            border: 2px solid transparent;
            font-size: 17px;
            font-weight: 600;
            color: #1e3a8a;
            text-align: center;
            letter-spacing: 0.03em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reply-button:active {
            border-color: #4A90E2;
            background: #e2efff;
        }

        .reply-button.full {
            grid-column: span 2;
        }

        .divider {
            height: 1px;
            background: rgba(148, 163, 184, 0.25);
            margin: 12px 0 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #475569;
            margin-bottom: 8px;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 6px 10px;
            background: #fef9c3;
            border-radius: 999px;
            font-size: 14px;
            color: #854d0e;
            font-weight: 600;
            margin-right: 8px;
        }

        .support-card {
            background: #fff7ed;
            border-left: 6px solid #f97316;
        }

        .history-section {
            background: #f8fafc;
            border-radius: 16px;
            padding: 16px;
            margin: 16px 0;
        }

        .history-title {
            font-size: 16px;
            font-weight: 700;
            color: #64748b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-item {
            background: #fff;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }

        .history-item:hover {
            background: #f1f5f9;
        }

        .history-item:active {
            transform: scale(0.98);
        }

        .history-date {
            font-size: 14px;
            font-weight: 600;
            color: #4A90E2;
            margin-bottom: 4px;
        }

        .history-content {
            font-size: 14px;
            color: #64748b;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 450px) {
            body {
                padding: 0;
            }
            .phone-frame {
                border-radius: 0;
                padding: 0;
                height: 100vh;
                max-width: 100%;
            }
            .screen {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="screen">
            <div class="status-bar">
                <span>9:41</span>
                <span><i class="fa-solid fa-signal"></i> <i class="fa-solid fa-wifi"></i> 100%</span>
            </div>
            <div class="chat-header">
                <div class="assistant-name">FUN・A・ROOM ケアナビ</div>
                <div class="assistant-subtitle">田中さん、今日も元気に過ごしましょう。困ったらいつでも声をかけてくださいね。</div>
            </div>
            <div class="chat-body" id="chatBody">
                <!-- 会話はJavaScriptで動的に追加されます -->
            </div>
            <div class="chat-footer">
                <div class="footer-title">かんたん操作ボタン</div>
                <div class="reply-grid">
                    <button class="reply-button" onclick="startDailyCheck()"><i class="fa-solid fa-pen-to-square"></i> 記録する</button>
                    <button class="reply-button" onclick="showGameMenu()"><i class="fa-solid fa-gamepad"></i> ゲーム</button>
                    <button class="reply-button" onclick="showHealthCheck()"><i class="fa-solid fa-stethoscope"></i> 健康診断</button>
                    <button class="reply-button" onclick="showActivities()"><i class="fa-solid fa-people-group"></i> 部活動</button>
                    <button class="reply-button full" onclick="showHistory()"><i class="fa-solid fa-clock-rotate-left"></i> 履歴を見る</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 状態管理
        let conversationHistory = [];
        let currentConversation = [];
        let dailyAnswers = {};
        let healthAnswers = {};
        let currentQuestion = 0;

        // 初期メッセージを表示
        function init() {
            showWelcomeMessage();
        }

        // ウェルカムメッセージ
        function showWelcomeMessage() {
            clearChat();
            addAssistantMessage(
                'おはようございます。今日はどのメニューから始めますか？大きなボタンから選べば大丈夫です。',
                `<div class="quick-actions">
                    <button class="quick-button" onclick="startDailyCheck()"><i class="fa-solid fa-pen-to-square"></i>今日の記録</button>
                    <button class="quick-button" onclick="showGameMenu()"><i class="fa-solid fa-gamepad"></i>健康ゲーム</button>
                    <button class="quick-button" onclick="showHealthCheck()"><i class="fa-solid fa-stethoscope"></i>月1健康診断</button>
                    <button class="quick-button" onclick="showActivities()"><i class="fa-solid fa-people-group"></i>部活動を見る</button>
                </div>`
            );
        }

        // チャットをクリア
        function clearChat() {
            const chatBody = document.getElementById('chatBody');
            chatBody.innerHTML = '';
            currentConversation = [];
        }

        // アシスタントメッセージを追加
        function addAssistantMessage(text, html = '') {
            const chatBody = document.getElementById('chatBody');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message assistant';
            messageDiv.innerHTML = `
                <div class="avatar">F</div>
                <div class="bubble">
                    ${text}
                    ${html}
                </div>
            `;
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;

            // 会話を記録
            currentConversation.push({
                type: 'assistant',
                content: text,
                timestamp: new Date()
            });
        }

        // ユーザーメッセージを追加
        function addUserMessage(text) {
            const chatBody = document.getElementById('chatBody');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="avatar"><i class="fa-solid fa-user"></i></div>
                <div class="bubble">${text}</div>
            `;
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;

            // 会話を記録
            currentConversation.push({
                type: 'user',
                content: text,
                timestamp: new Date()
            });
        }

        // 今日の記録を開始
        function startDailyCheck() {
            addUserMessage('今日の記録をお願いします。');

            setTimeout(() => {
                dailyAnswers = {};
                currentQuestion = 0;
                askDailyQuestion(0);
            }, 500);
        }

        // 日々の質問
        const dailyQuestions = [
            {
                question: '体調はいかがですか?',
                options: [
                    { text: '元気', icon: 'fa-regular fa-face-smile' },
                    { text: 'いつも通り', icon: 'fa-regular fa-face-meh' },
                    { text: '疲れ気味', icon: 'fa-regular fa-face-frown' }
                ]
            },
            {
                question: '食事はしっかりとれましたか?',
                options: [
                    { text: 'はい', icon: null },
                    { text: 'いいえ', icon: null },
                    { text: '覚えていない', icon: null }
                ]
            },
            {
                question: '最後に今日の歩数を教えてください。',
                type: 'steps'
            }
        ];

        // 日々の質問を表示
        function askDailyQuestion(index) {
            if (index >= dailyQuestions.length) {
                completeDailyCheck();
                return;
            }

            const q = dailyQuestions[index];
            let html = '';

            if (q.type === 'steps') {
                html = `
                    <div class="card">
                        <div class="section-title">歩数入力</div>
                        <p>今日の歩数に近い数値を選んでください。</p>
                        <div class="action-row">
                            <button class="card-button secondary" onclick="answerDaily(${index}, '1,000歩未満')">1,000歩未満</button>
                            <button class="card-button secondary" onclick="answerDaily(${index}, '1,000〜4,999歩')">1,000〜4,999歩</button>
                            <button class="card-button secondary" onclick="answerDaily(${index}, '5,000〜7,999歩')">5,000〜7,999歩</button>
                            <button class="card-button secondary" onclick="answerDaily(${index}, '8,000歩以上')">8,000歩以上</button>
                        </div>
                        <div class="progress"><span>${index + 1} / ${dailyQuestions.length}</span> 問目です。</div>
                    </div>
                `;
            } else {
                const buttons = q.options.map(opt => {
                    const icon = opt.icon ? `<i class="${opt.icon}"></i>` : '';
                    return `<button class="quick-button" onclick="answerDaily(${index}, '${opt.text}')">${icon}${opt.text}</button>`;
                }).join('');

                html = `<div class="quick-actions">${buttons}</div>`;
            }

            const questionText = q.type === 'steps' ? q.question :
                `${q.question}${index < dailyQuestions.length - 1 ? ` (${index + 1}問目 / 全${dailyQuestions.length}問)` : ''}`;

            addAssistantMessage(questionText, html);
        }

        // 日々の質問への回答
        function answerDaily(index, answer) {
            dailyAnswers[`question${index}`] = answer;
            addUserMessage(answer);

            setTimeout(() => {
                askDailyQuestion(index + 1);
            }, 500);
        }

        // 日々のチェック完了
        function completeDailyCheck() {
            addAssistantMessage(
                '今日の記録が完了しました。毎日続けると体調の変化が分かりやすくなりますよ。',
                `<div class="quick-actions">
                    <button class="quick-button" onclick="startDailyCheck()"><i class="fa-solid fa-arrow-rotate-left"></i>もう一度記録</button>
                    <button class="quick-button" onclick="showWelcomeMessage()"><i class="fa-solid fa-house"></i>メニューへ戻る</button>
                </div>`
            );

            // 履歴に保存
            saveToHistory('今日の健康記録', '記録を完了しました');
        }

        // 健康ゲームメニュー
        function showGameMenu() {
            addUserMessage('健康ゲームを見せて。');

            setTimeout(() => {
                addAssistantMessage(
                    '楽しく身体を動かしましょう。やりたいゲームを選んでください。',
                    `<div class="card">
                        <h3>健康ゲームメニュー</h3>
                        <div class="tag"><i class="fa-solid fa-heart-pulse"></i>&nbsp;安全第一</div>
                        <p>それぞれのゲームは、開始前に周りの安全を確認してください。</p>
                        <div class="action-row">
                            <button class="card-button" onclick="startBalanceGame()"><i class="fa-solid fa-person-walking"></i>&nbsp;片足立ちチャレンジ</button>
                            <button class="card-button" onclick="startReactionGame()"><i class="fa-solid fa-bolt"></i>&nbsp;反応速度テスト</button>
                            <button class="card-button" onclick="startFingerRingTest()"><i class="fa-solid fa-ring"></i>&nbsp;指輪っかテスト</button>
                        </div>
                    </div>`
                );
            }, 500);
        }

        // 片足立ちゲーム
        function startBalanceGame() {
            addUserMessage('片足立ちチャレンジを始めます。');

            setTimeout(() => {
                addAssistantMessage(
                    '片足立ちチャレンジの準備ができました。',
                    `<div class="card">
                        <h3><i class="fa-solid fa-person-walking"></i> 片足立ちチャレンジ</h3>
                        <p>1. 周りに危ないものがないか確認しましょう。</p>
                        <p>2. 下のボタンを長押しして片足立ち、倒れそうになったら離してください。</p>
                        <div class="action-row">
                            <button class="card-button" onclick="alert('長押しで計測を開始します！')"><i class="fa-solid fa-play"></i>&nbsp;スタート</button>
                            <button class="card-button secondary" onclick="showGameMenu()"><i class="fa-solid fa-rotate-left"></i>&nbsp;戻る</button>
                        </div>
                    </div>`
                );
            }, 500);
        }

        // 反応速度ゲーム
        function startReactionGame() {
            addUserMessage('反応速度テストを始めます。');

            setTimeout(() => {
                addAssistantMessage(
                    '反応速度テストの準備ができました。',
                    `<div class="card">
                        <h3><i class="fa-solid fa-bolt"></i> 反応速度テスト</h3>
                        <p>画面が緑色に変わったら、できるだけ早くタップしてください。</p>
                        <div class="action-row">
                            <button class="card-button" onclick="alert('反応速度テストを開始します！')"><i class="fa-solid fa-play"></i>&nbsp;スタート</button>
                            <button class="card-button secondary" onclick="showGameMenu()"><i class="fa-solid fa-rotate-left"></i>&nbsp;戻る</button>
                        </div>
                    </div>`
                );
            }, 500);
        }

        // 指輪っかテスト
        function startFingerRingTest() {
            addUserMessage('指輪っかテストを始めます。');

            setTimeout(() => {
                addAssistantMessage(
                    '指輪っかテストの説明です。',
                    `<div class="card">
                        <h3><i class="fa-solid fa-ring"></i> 指輪っかテスト</h3>
                        <p>両手の親指と人差し指で輪を作り、ふくらはぎの一番太いところを囲みます。</p>
                        <p>結果を選んでください:</p>
                        <div class="action-row">
                            <button class="card-button secondary" onclick="fingerRingResult('届かない')">指が届かず輪が閉じない</button>
                            <button class="card-button secondary" onclick="fingerRingResult('ちょうど')">ちょうどふくらはぎに触れる</button>
                            <button class="card-button secondary" onclick="fingerRingResult('余る')">輪が余ってすき間ができる</button>
                        </div>
                    </div>`
                );
            }, 500);
        }

        // 指輪っかテスト結果
        function fingerRingResult(result) {
            addUserMessage(result);

            setTimeout(() => {
                let message = '';
                if (result === '届かない') {
                    message = '筋力は十分です。ふくらはぎがしっかりしている状態です。今の運動習慣を続けましょう。';
                } else if (result === 'ちょうど') {
                    message = 'やや注意が必要です。筋肉量が少し低下している可能性があります。軽い筋トレや散歩を取り入れましょう。';
                } else {
                    message = 'サルコペニアのリスクがあります。筋肉量がかなり低下している可能性があります。専門家に相談することをおすすめします。';
                }

                addAssistantMessage(
                    message,
                    `<div class="quick-actions">
                        <button class="quick-button" onclick="showGameMenu()"><i class="fa-solid fa-rotate-left"></i>ゲームメニューへ</button>
                        <button class="quick-button" onclick="showWelcomeMessage()"><i class="fa-solid fa-house"></i>メインメニューへ</button>
                    </div>`
                );

                saveToHistory('指輪っかテスト', `結果: ${result}`);
            }, 500);
        }

        // 月1健康診断
        function showHealthCheck() {
            addUserMessage('月1健康診断を見せて。');

            setTimeout(() => {
                addAssistantMessage(
                    '月1健康診断（フレイルチェック）もいつでもできます。準備はよろしいですか?',
                    `<div class="card">
                        <h3>フレイルチェック</h3>
                        <p>全5問です。所要時間は3分ほど。ゆっくり進めましょう。</p>
                        <div class="action-row">
                            <button class="card-button" onclick="startHealthCheck()"><i class="fa-solid fa-play"></i>&nbsp;診断を開始</button>
                            <button class="card-button secondary" onclick="showWelcomeMessage()"><i class="fa-solid fa-rotate-left"></i>&nbsp;戻る</button>
                        </div>
                    </div>`
                );
            }, 500);
        }

        // 健康診断開始
        function startHealthCheck() {
            addUserMessage('診断を始めます。');
            healthAnswers = {};

            setTimeout(() => {
                addAssistantMessage(
                    '最近、体重が減りましたか? (1 / 5問目)',
                    `<div class="quick-actions">
                        <button class="quick-button" onclick="answerHealth(1, 'はい')">はい</button>
                        <button class="quick-button" onclick="answerHealth(1, 'いいえ')">いいえ</button>
                        <button class="quick-button" onclick="answerHealth(1, 'わからない')">わからない</button>
                    </div>`
                );
            }, 500);
        }

        // 健康診断の質問
        const healthQuestions = [
            '最近、体重が減りましたか?',
            '食事を食べる時むせることがありますか?',
            '週に何回運動していますか?',
            '薬の飲み忘れはありますか?',
            '最近、気分が落ち込みますか?'
        ];

        // 健康診断への回答
        function answerHealth(questionNum, answer) {
            healthAnswers[`q${questionNum}`] = answer;
            addUserMessage(answer);

            setTimeout(() => {
                if (questionNum < 5) {
                    const nextQ = healthQuestions[questionNum];
                    addAssistantMessage(
                        `${nextQ} (${questionNum + 1} / 5問目)`,
                        `<div class="quick-actions">
                            <button class="quick-button" onclick="answerHealth(${questionNum + 1}, 'はい')">はい</button>
                            <button class="quick-button" onclick="answerHealth(${questionNum + 1}, 'いいえ')">いいえ</button>
                            <button class="quick-button" onclick="answerHealth(${questionNum + 1}, 'わからない')">わからない</button>
                        </div>`
                    );
                } else {
                    showHealthResult();
                }
            }, 500);
        }

        // 健康診断結果
        function showHealthResult() {
            addAssistantMessage(
                'フレイルチェックの結果です。',
                `<div class="card">
                    <h3>健康状態:良好</h3>
                    <p>引き続き今の習慣を大切にしましょう。水分補給と睡眠がポイントです。</p>
                    <div class="action-row">
                        <button class="card-button" onclick="alert('結果を共有します')"><i class="fa-solid fa-share"></i>&nbsp;結果を共有</button>
                        <button class="card-button secondary" onclick="showWelcomeMessage()"><i class="fa-solid fa-house"></i>&nbsp;ホームに戻る</button>
                    </div>
                </div>`
            );

            saveToHistory('フレイルチェック', '健康状態: 良好');
        }

        // 部活動を表示
        function showActivities() {
            addUserMessage('部活動の情報を教えて。');

            setTimeout(() => {
                addAssistantMessage(
                    '興味のある部活動を選んでください。',
                    `<div class="card">
                        <h3>おすすめ部活動</h3>
                        <p><strong>ウォーキング部</strong>:毎週火曜・午前10時 / 市民公園</p>
                        <p><strong>いきいきヨガ</strong>:毎週木曜・午後2時 / コミュニティセンター</p>
                        <p><strong>カラオケ交流会</strong>:月2回・午後1時 / FUN・A・ROOM</p>
                        <div class="action-row">
                            <button class="card-button secondary" onclick="showActivityDetail('ウォーキング部')">ウォーキング部</button>
                            <button class="card-button secondary" onclick="showActivityDetail('ヨガサークル')">ヨガサークル</button>
                            <button class="card-button secondary" onclick="showWelcomeMessage()">戻る</button>
                        </div>
                    </div>`
                );
            }, 500);
        }

        // 部活動詳細
        function showActivityDetail(activity) {
            addUserMessage(`${activity}について教えて。`);

            setTimeout(() => {
                addAssistantMessage(
                    `${activity}の詳細です。`,
                    `<div class="card">
                        <h3>${activity}</h3>
                        <p>朝の爽やかな空気の中、公園を約1時間ゆっくり歩きます。無理のないペースで、おしゃべりしながら楽しく歩きましょう。</p>
                        <p><strong>日時:</strong> 毎週火・木 朝7:00〜8:00</p>
                        <p><strong>場所:</strong> 日向市中央公園</p>
                        <p><strong>参加費:</strong> 無料</p>
                        <div class="action-row">
                            <button class="card-button" onclick="alert('参加申し込みを受け付けました！')"><i class="fa-solid fa-user-plus"></i>&nbsp;参加を申し込む</button>
                            <button class="card-button secondary" onclick="showActivities()"><i class="fa-solid fa-rotate-left"></i>&nbsp;一覧に戻る</button>
                        </div>
                    </div>`
                );
            }, 500);
        }

        // 履歴を表示
        function showHistory() {
            if (conversationHistory.length === 0) {
                addAssistantMessage(
                    'まだ履歴がありません。',
                    `<div class="quick-actions">
                        <button class="quick-button" onclick="showWelcomeMessage()"><i class="fa-solid fa-house"></i>メインメニューへ</button>
                    </div>`
                );
                return;
            }

            let historyHtml = '<div class="history-section"><div class="history-title"><i class="fa-solid fa-clock-rotate-left"></i> 最近の記録</div>';

            conversationHistory.slice(-5).reverse().forEach((item, index) => {
                const date = new Date(item.timestamp);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                historyHtml += `
                    <div class="history-item" onclick="alert('${item.title}の詳細を表示')">
                        <div class="history-date">${dateStr}</div>
                        <div class="history-content">${item.title}: ${item.summary}</div>
                    </div>
                `;
            });

            historyHtml += '</div>';

            addAssistantMessage(
                '直近の記録です。気になる日付を選べます。',
                historyHtml + `<div class="quick-actions">
                    <button class="quick-button" onclick="showWelcomeMessage()"><i class="fa-solid fa-house"></i>メインメニューへ</button>
                </div>`
            );
        }

        // 履歴に保存
        function saveToHistory(title, summary) {
            conversationHistory.push({
                title: title,
                summary: summary,
                conversation: [...currentConversation],
                timestamp: new Date()
            });
        }

        // 初期化
        window.onload = init;
    </script>
</body>
</html>
